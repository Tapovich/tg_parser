# Устранение неполадок с мониторингом

## Проблема
Бот не видит новые посты, несмотря на то что количество постов изменяется.

## Пошаговая диагностика

### 1. Проверка статуса бота
```bash
/bot_status
```
**Проверьте:**
- ✅ Бот доступен для уведомлений
- ✅ Telethon клиент инициализирован
- ✅ Ключевые слова загружены
- ✅ Количество каналов и RSS источников

### 2. Тестирование уведомлений
```bash
/test_notification
```
**Проверьте:**
- ✅ Создается тестовый пост
- ✅ Отправляется уведомление
- ✅ Работают кнопки

### 3. Проверка времени последней проверки
```bash
/check_times
```
**Проверьте:**
- ✅ Время последней проверки каждого источника
- ✅ Не слишком ли старое время

### 4. Принудительный сброс и мониторинг
```bash
/force_monitor
```
**Что делает:**
- ✅ Сбрасывает время проверки на 48 часов назад
- ✅ Запускает полный цикл мониторинга
- ✅ Показывает подробную диагностику

### 5. Проверка конкретного канала
```bash
/check_channel @channel_name
```
**Проверьте:**
- ✅ Количество новых сообщений
- ✅ Количество релевантных постов
- ✅ Время последней проверки

## Возможные причины и решения

### 1. Проблемы с временем проверки
**Симптомы:** Время последней проверки слишком новое
**Решение:** 
```bash
/reset_checks
/force_monitor
```

### 2. Проблемы с ключевыми словами
**Симптомы:** Сообщения есть, но не содержат ключевых слов
**Решение:**
```bash
/test_keywords
```
Проверьте настройки `KEYWORDS` в `config.py`

### 3. Проблемы с Telethon
**Симптомы:** Telethon клиент не инициализирован
**Решение:** Проверьте настройки в `.env`:
- `API_ID`
- `API_HASH`
- `PHONE_NUMBER`

### 4. Проблемы с ботом
**Симптомы:** Бот не доступен для уведомлений
**Решение:** Проверьте `BOT_TOKEN` в `.env`

### 5. Проблемы с каналами
**Симптомы:** Каналы недоступны или заблокированы
**Решение:** Проверьте доступность каналов вручную

## Команды для диагностики

### Основные команды
- `/bot_status` - полный статус системы
- `/test_notification` - тест уведомлений
- `/check_times` - время проверки источников
- `/force_monitor` - принудительный мониторинг
- `/check_channel @name` - проверка конкретного канала

### Дополнительные команды
- `/reset_checks` - сброс времени проверки
- `/monitor` - ручной запуск мониторинга
- `/stats` - статистика постов
- `/queue` - очередь черновиков

## Логи для анализа

### Успешный мониторинг
```
INFO - Канал @channel: время последней проверки 2025-07-27 10:00:00+00:00
INFO - Обрабатываем канал @channel: 5 сообщений
DEBUG - Обрабатываем новое сообщение 123: 2025-07-27 11:00:00+00:00
DEBUG - Найдены ключевые слова: ['Telegram', 'TON']
INFO - Добавляем новый TG пост: Текст сообщения...
INFO - Отправляем уведомление о посте #456
```

### Проблемы в логах
```
WARNING - Бот не доступен для уведомления о посте #456
ERROR - Telethon клиент не инициализирован
DEBUG - Сообщение 123 не содержит ключевых слов
DEBUG - Пропускаем старое сообщение 123: 2025-07-27 10:00:00+00:00 <= 2025-07-27 11:00:00+00:00
```

## Быстрое решение

1. **Сбросить время проверки:**
   ```bash
   /reset_checks
   ```

2. **Запустить принудительный мониторинг:**
   ```bash
   /force_monitor
   ```

3. **Проверить конкретный канал:**
   ```bash
   /check_channel @durov
   ```

4. **Проверить статус:**
   ```bash
   /bot_status
   ```

## Статус
- ✅ Добавлены команды для диагностики
- ✅ Подробное логирование всех этапов
- ✅ Принудительный сброс времени проверки
- ✅ Проверка конкретных каналов
- ✅ Тестирование уведомлений 