# Диагностика проблем с уведомлениями

## Проблема
Бот видит изменения в количестве постов, но не отправляет уведомления о новых постах.

## Диагностика

### 1. Проверка статуса бота
Используйте команду `/bot_status` для проверки:
- ✅ Статус бота
- ✅ Статус content_monitor
- ✅ Доступность экземпляра бота
- ✅ Статус Telethon клиента
- ✅ Статус HTTP сессии

### 2. Тестирование уведомлений
Используйте команду `/test_notification` для проверки:
- ✅ Создание тестового поста
- ✅ Отправка уведомления
- ✅ Работа кнопок

### 3. Проверка логов
Добавлена подробная отладочная информация:
- ✅ Время последней проверки источников
- ✅ Обработка новых сообщений
- ✅ Поиск ключевых слов
- ✅ Создание черновиков
- ✅ Отправка уведомлений

## Возможные причины

### 1. Экземпляр бота не установлен
**Симптомы:** В логах "Бот не доступен для уведомления"
**Решение:** Проверить передачу бота в `main.py` и `scheduler.py`

### 2. Проблемы с ключевыми словами
**Симптомы:** Сообщения обрабатываются, но не содержат ключевых слов
**Решение:** Проверить настройки `KEYWORDS` в конфигурации

### 3. Проблемы с датами
**Симптомы:** Сообщения считаются старыми
**Решение:** Использовать `/reset_checks` для сброса времени

### 4. Проблемы с flood control
**Симптомы:** Уведомления блокируются
**Решение:** Проверить логи на ошибки flood control

## Команды для диагностики

### Основные команды
- `/bot_status` - статус бота и мониторинга
- `/test_notification` - тест уведомлений
- `/check_times` - время последней проверки
- `/reset_checks` - сброс времени проверки

### Дополнительные команды
- `/monitor` - ручной запуск мониторинга
- `/stats` - статистика постов
- `/queue` - очередь черновиков

## Отладочная информация

### Логи мониторинга
```
INFO - Канал @channel: время последней проверки 2025-07-27 10:00:00+00:00
INFO - Обрабатываем канал @channel: 5 сообщений
DEBUG - Обрабатываем новое сообщение 123: 2025-07-27 11:00:00+00:00
DEBUG - Найдены ключевые слова: ['Telegram', 'TON']
INFO - Добавляем новый TG пост: Текст сообщения...
INFO - Отправляем уведомление о посте #456
```

### Логи уведомлений
```
INFO - Начинаем уведомление о посте #456
INFO - Черновик #456 найден: Текст сообщения...
INFO - Отправляем уведомление админу 123456789 о посте #456
INFO - Уведомление о посте #456 отправлено админу 123456789
```

## Решение проблем

### Если бот не установлен
1. Проверить `main.py` - передача бота в scheduler
2. Проверить `scheduler.py` - передача бота в content_monitor
3. Проверить `content_monitor.py` - установка bot_instance

### Если нет ключевых слов
1. Проверить `config.py` - настройки KEYWORDS
2. Использовать `/test_keywords` для тестирования
3. Добавить больше ключевых слов

### Если проблемы с датами
1. Использовать `/reset_checks` для сброса
2. Проверить `/check_times` для диагностики
3. Убедиться в правильности часовых поясов

## Статус
- ✅ Добавлена подробная отладочная информация
- ✅ Созданы команды для диагностики
- ✅ Добавлены тесты уведомлений
- ✅ Улучшено логирование всех этапов 